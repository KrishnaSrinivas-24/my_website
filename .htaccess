# Enhanced Security Configuration for Portfolio Website

## This file provides server-level security configurations for Apache servers

# ==============================================================================
# SECURITY HEADERS
# ==============================================================================

# Prevent MIME type sniffing
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options "nosniff"
    
    # Prevent framing
    Header always set X-Frame-Options "DENY"
    
    # XSS Protection
    Header always set X-XSS-Protection "1; mode=block"
    
    # Referrer Policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Content Security Policy
    Header always set Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.tailwindcss.com https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; object-src 'none'; base-uri 'self'; frame-ancestors 'none'; form-action 'self'; upgrade-insecure-requests;"
    
    # Permissions Policy
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=(), screen-wake-lock=(), accelerometer=(), gyroscope=(), magnetometer=(), clipboard-read=(), clipboard-write=(), display-capture=(), fullscreen=()"
    
    # Strict Transport Security (HTTPS only)
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    
    # Cache Control for Security
    Header always set Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate"
    Header always set Pragma "no-cache"
    Header always set Expires "0"
    
    # Remove Server Information
    Header unset Server
    Header unset X-Powered-By
    
    # Feature Policy (Legacy support)
    Header always set Feature-Policy "geolocation 'none'; microphone 'none'; camera 'none'; payment 'none'; usb 'none'"
</IfModule>

# ==============================================================================
# BLOCK MALICIOUS REQUESTS
# ==============================================================================

# Block access to sensitive files
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|inc|bak|sql|conf|fla|psd|exe)$">
    Require all denied
</FilesMatch>

# Block access to hidden files
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Block bot and scraper user agents
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Block common bots and scrapers
    RewriteCond %{HTTP_USER_AGENT} (bot|crawler|spider|scraper|curl|wget|python|php|java|apache|nginx|headless|phantom|selenium|webdriver|puppeteer|playwright) [NC]
    RewriteRule .* - [F,L]
    
    # Block requests with suspicious query parameters
    RewriteCond %{QUERY_STRING} (eval\(|base64_|javascript:|vbscript:|onload=|onerror=) [NC,OR]
    RewriteCond %{QUERY_STRING} (<script|</script|<iframe|</iframe|<object|</object) [NC,OR]
    RewriteCond %{QUERY_STRING} (union.*select|insert.*into|update.*set|delete.*from) [NC]
    RewriteRule .* - [F,L]
    
    # Block suspicious request methods
    RewriteCond %{REQUEST_METHOD} ^(PUT|DELETE|TRACE|TRACK|OPTIONS) [NC]
    RewriteRule .* - [F,L]
    
    # Block direct access to certain files
    RewriteCond %{THE_REQUEST} \s/+resume\.html [NC]
    RewriteCond %{HTTP_REFERER} !^https?://.*\.github\.io/ [NC]
    RewriteCond %{HTTP_REFERER} !^https?://localhost/ [NC]
    RewriteRule .* - [F,L]
</IfModule>

# ==============================================================================
# RATE LIMITING
# ==============================================================================

# Limit request rate (if mod_evasive is available)
<IfModule mod_evasive.c>
    DOSHashTableSize    2048
    DOSPageCount        10
    DOSPageInterval     1
    DOSSiteCount        50
    DOSSiteInterval     1
    DOSBlockingPeriod   600
</IfModule>

# ==============================================================================
# DISABLE SERVER SIGNATURE
# ==============================================================================

ServerTokens Prod
ServerSignature Off

# ==============================================================================
# DISABLE DIRECTORY BROWSING
# ==============================================================================

Options -Indexes

# ==============================================================================
# PREVENT HOTLINKING
# ==============================================================================

<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^https?://.*\.github\.io/ [NC]
    RewriteCond %{HTTP_REFERER} !^https?://localhost/ [NC]
    RewriteRule \.(jpe?g|png|gif|svg|ico|pdf|doc|docx)$ - [F,L]
</IfModule>

# ==============================================================================
# COMPRESSION AND CACHING (Secure)
# ==============================================================================

# Enable compression for text files only
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# Set secure cache headers for static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 day"
    ExpiresByType application/javascript "access plus 1 day"
    ExpiresByType image/png "access plus 1 week"
    ExpiresByType image/jpg "access plus 1 week"
    ExpiresByType image/jpeg "access plus 1 week"
    ExpiresByType image/gif "access plus 1 week"
    ExpiresByType image/svg+xml "access plus 1 week"
</IfModule>

# ==============================================================================
# REDIRECT HTTP TO HTTPS
# ==============================================================================

<IfModule mod_rewrite.c>
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>